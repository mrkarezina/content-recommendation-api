import unittest
import json

from article_processor import download, fetch_article, article_processor


class ArticleProcessorTestCase(unittest.TestCase):

    def test_article_fetch(self):
        response = fetch_article(
            url='http://www.physiciansnewsnetwork.com/ximed/study-hospital-physician-vertical-integration-has-little-impact-on-quality/article_257c41a0-3a11-11e9-952b-97cc981efd76.html')

        self.assertEqual(response,
                         {
                             "text": "According to a recent Modern Healthcare CEO Power Panel survey, there is less of an appetite for mergers and acquisitions this year than in 2018. In 2019, 12.5% of CEOs said M&A best describes their growth strategy, down from 25.8% in 2018. San Diego-based Scripps Health is among the 42% of respondents that said their priority will be updating current business lines, although CEO Chris Van Gorder said the system would also welcome joint partnerships that can bring both economic savings and greater expertise. Scripps is already involved in a number of such deals. As health systems can't employ physicians directly in California, Scripps has about 1,000 physicians in its medical foundation. Unless the system can work closely with them, it won't be able to lower supply chain costs or better manage patient flows, Van Gorder said in the article. \u201cI get it,\u201d he said. \u201cI understand why the government has those laws in place. But since that law was put in place years ago, medicine has changed dramatically. Doctors and hospitals have to be economically aligned.\u201d\n\nVertical integration between hospitals and physicians has had very little impact on quality of care, according to a new study by experts at Rice University's Baker Institute for Public Policy.\n\nThe study comes as healthcare provider organizations are becoming more complex, with hospitals acquiring physician practices and physician organizations getting larger. At the same time, hospitals are merging with each other to improve bargaining power with insurers, the authors said.\n\nThe researchers analyzed information from the Centers for Medicare and Medicaid Services' Hospital Compare database for 2008 to 2015. Among the 29 data points studied, the researchers analyzed hospital readmission rates, process of care measurements that gauge how well a hospital provides care to its patients, and patient satisfaction scores. Using that information, they tested whether patient outcomes are influenced by greater hospital market concentration or vertical integration between hospitals and physicians.\n\n\"Weighing the Effects of Vertical Integration Versus Market Concentration on Hospital Quality\" was co-authored by Marah Short, associate director of the institute's Center for Health and Biosciences, and Vivian Ho, the James A. Baker III Institute Chair in Health Economics and director of the center. It will be published in Medical Care Research and Review.\n\nBefore they launched their study, the researchers hypothesized that decreased fragmentation, meaning better coordination among a patient's primary care physician, specialists and admitting and attending hospital physicians, could improve patient care. Instead, they found that vertical integration has a limited effect.\n\n\"The government requires that hospitals report on a wide variety of quality measures, such as practice of preventive care for surgical patients, whether their doctor or nurse communicated well, or whether the patient would recommend the hospital to others,\" Ho said in a press release. \"Physician-hospital integration did not improve the quality of care for the overwhelming majority of these measures. If patient welfare doesn't improve after integration, there may be other reasons why physicians and hospitals are forming closer relationships \u2014 perhaps to raise profits.\"\n\nOn the other hand, increased market concentration, which lowers market competition, is strongly associated with reduced quality measured in terms of patient satisfaction, the authors said. With fewer competitors, it seems there is less incentive to keep patients happy. Given the nature of some satisfaction measures, such as explaining medications and communicating well with patients, overall clinical quality could suffer if patients do not properly understand care recommendations during their hospital stay or post-discharge, the authors said.\n\n\"Although better patient experience may not always correlate with higher clinical quality, measuring quality based on patient perception is increasingly important as more consumers use online physician ratings and reviews of patient experience to select providers,\" Short said. \"Therefore, we need further research on the ability of patient satisfaction to reflect clinical quality, and if it does not, we need to develop and provide to patients better measures in terms that patients can understand and use.\"\n\n\"Our overall recommendation is one shared with previous researchers: Regulators should continue to focus scrutiny on proposed hospital mergers, take steps to maintain competition and reduce counterproductive barriers to entry,\" the authors wrote in a summary of their paper.",
                             "title": "Study: Hospital-Physician Vertical Integration Has Little Impact on Quality of Care; Greater Market Concentration Reduces It",
                             "date": "None",
                             "img_url": "https://bloximages.newyork1.vip.townnews.com/physiciansnewsnetwork.com/content/tncms/assets/v3/editorial/e/7d/e7d1429e-953a-11e4-be35-a7a638411b2d/54ab2c5223f3a.image.jpg?resize=300%2C300",
                             "url": "http://www.physiciansnewsnetwork.com/ximed/study-hospital-physician-vertical-integration-has-little-impact-on-quality/article_257c41a0-3a11-11e9-952b-97cc981efd76.html"})

        response = fetch_article(
            url='https://www.cnn.com/2019/03/25/us/yale-rescinds-student-admissions-scandal/index.html')
        self.assertEqual(response,
                         {
                             'text': '(CNN) Yale University has rescinded the admission of a student who was admitted as part of the ongoing college admissions scandal, the first instance of a school doing so since the scheme became public two weeks ago.\n\nYale has said two people applied to the university with fraudulent athletic endorsements from women\'s soccer coach Rudy Meredith. One was denied admission despite the endorsement, and the other was admitted and was attending Yale, the university said on its website\n\nA Yale spokesman did not provide any more information on the student.\n\nThe decision comes as Yale, USC, UCLA and other major universities deal with the fallout from the sprawling scandal. Prosecutors have arrested 50 people, including 33 wealthy parents, for carrying out a scheme to cheat on standardized tests and/or bribe college coaches, who then helped the prospective students gain admission by falsely claiming they were athletic recruits.\n\nThe mastermind of the scheme, Rick Singer, is cooperating with prosecutors and has pleaded guilty to charges of racketeering, money laundering conspiracy, conspiracy to defraud the US and obstruction of justice.\n\nMeredith is also cooperating with prosecutors and has agreed to plead guilty to honest services wire fraud and related charges, according to court documents\n\nLittle is known about the identity of the Yale student who was admitted. The student is identified in court documents only as "Yale Applicant 1."\n\nAs part of the scheme, Singer helped create a false athletic profile for the student, court documents state. Singer sent that fake profile to Meredith, who then falsely designated the applicant as a women\'s soccer recruit to help her gain admission to Yale, according to a criminal indictment\n\nThe applicant\'s parents paid $1.2 million to Singer for the arrangement in the spring and summer of 2018, and Singer mailed Meredith a check for $400,000 after the applicant was admitted to Yale. The parents are not named in the complaint.\n\nIn April 2018, Meredith solicited a bribe from the father of a second applicant, but the meeting was an FBI set-up, according to court documents. He began cooperating with federal investigators that same month, and resigned as coach in November 2018.\n\nYale had signaled that it would rescind the student\'s application in a Frequently Asked Question section of its website from March 15.\n\n"On the very rare occasion when Yale receives an allegation that a current student included false information in an application, Yale gives the student the opportunity to address the allegation," the website said.\n\n"If Yale determines that the allegation is true, the student\'s admission is rescinded, based on language in the application that requires applicants to affirm that everything in the application is true and complete."\n\nYale spokesman Tom Conroy said last week there won\'t be any delay in admissions decisions for the 2019-2020 academic year despite the scandal.',
                             'title': 'Yale rescinds admission of a student whose family paid $1.2 million to get her in',
                             'date': '2019-03-25 00:00:00',
                             'img_url': 'https://cdn.cnn.com/cnnnext/dam/assets/190314070907-02-college-admissions-scam-yale-super-tease.jpg',
                             'url': 'https://www.cnn.com/2019/03/25/us/yale-rescinds-student-admissions-scandal/index.html'})

    def test_article_processor(self):
        response, is_valid = article_processor(
            url='http://www.physiciansnewsnetwork.com/ximed/study-hospital-physician-vertical-integration-has-little-impact-on-quality/article_257c41a0-3a11-11e9-952b-97cc981efd76.html', processor_id = "language-processor-health")

        self.assertEqual(len(response['embedding']), 250)

        del response['embedding']

        self.assertEqual(response,
                         {
                             'text': 'According to a recent Modern Healthcare CEO Power Panel survey, there is less of an appetite for mergers and acquisitions this year than in 2018. In 2019, 12.5% of CEOs said M&A best describes their growth strategy, down from 25.8% in 2018. San Diego-based Scripps Health is among the 42% of respondents that said their priority will be updating current business lines, although CEO Chris Van Gorder said the system would also welcome joint partnerships that can bring both economic savings and greater expertise. Scripps is already involved in a number of such deals. As health systems can\'t employ physicians directly in California, Scripps has about 1,000 physicians in its medical foundation. Unless the system can work closely with them, it won\'t be able to lower supply chain costs or better manage patient flows, Van Gorder said in the article. “I get it,” he said. “I understand why the government has those laws in place. But since that law was put in place years ago, medicine has changed dramatically. Doctors and hospitals have to be economically aligned.”\n\nVertical integration between hospitals and physicians has had very little impact on quality of care, according to a new study by experts at Rice University\'s Baker Institute for Public Policy.\n\nThe study comes as healthcare provider organizations are becoming more complex, with hospitals acquiring physician practices and physician organizations getting larger. At the same time, hospitals are merging with each other to improve bargaining power with insurers, the authors said.\n\nThe researchers analyzed information from the Centers for Medicare and Medicaid Services\' Hospital Compare database for 2008 to 2015. Among the 29 data points studied, the researchers analyzed hospital readmission rates, process of care measurements that gauge how well a hospital provides care to its patients, and patient satisfaction scores. Using that information, they tested whether patient outcomes are influenced by greater hospital market concentration or vertical integration between hospitals and physicians.\n\n"Weighing the Effects of Vertical Integration Versus Market Concentration on Hospital Quality" was co-authored by Marah Short, associate director of the institute\'s Center for Health and Biosciences, and Vivian Ho, the James A. Baker III Institute Chair in Health Economics and director of the center. It will be published in Medical Care Research and Review.\n\nBefore they launched their study, the researchers hypothesized that decreased fragmentation, meaning better coordination among a patient\'s primary care physician, specialists and admitting and attending hospital physicians, could improve patient care. Instead, they found that vertical integration has a limited effect.\n\n"The government requires that hospitals report on a wide variety of quality measures, such as practice of preventive care for surgical patients, whether their doctor or nurse communicated well, or whether the patient would recommend the hospital to others," Ho said in a press release. "Physician-hospital integration did not improve the quality of care for the overwhelming majority of these measures. If patient welfare doesn\'t improve after integration, there may be other reasons why physicians and hospitals are forming closer relationships — perhaps to raise profits."\n\nOn the other hand, increased market concentration, which lowers market competition, is strongly associated with reduced quality measured in terms of patient satisfaction, the authors said. With fewer competitors, it seems there is less incentive to keep patients happy. Given the nature of some satisfaction measures, such as explaining medications and communicating well with patients, overall clinical quality could suffer if patients do not properly understand care recommendations during their hospital stay or post-discharge, the authors said.\n\n"Although better patient experience may not always correlate with higher clinical quality, measuring quality based on patient perception is increasingly important as more consumers use online physician ratings and reviews of patient experience to select providers," Short said. "Therefore, we need further research on the ability of patient satisfaction to reflect clinical quality, and if it does not, we need to develop and provide to patients better measures in terms that patients can understand and use."\n\n"Our overall recommendation is one shared with previous researchers: Regulators should continue to focus scrutiny on proposed hospital mergers, take steps to maintain competition and reduce counterproductive barriers to entry," the authors wrote in a summary of their paper.',
                             'title': 'Study: Hospital-Physician Vertical Integration Has Little Impact on Quality of Care; Greater Market Concentration Reduces It',
                             'date': 'None',
                             'img_url': 'https://bloximages.newyork1.vip.townnews.com/physiciansnewsnetwork.com/content/tncms/assets/v3/editorial/e/7d/e7d1429e-953a-11e4-be35-a7a638411b2d/54ab2c5223f3a.image.jpg?resize=300%2C300',
                             'url': 'http://www.physiciansnewsnetwork.com/ximed/study-hospital-physician-vertical-integration-has-little-impact-on-quality/article_257c41a0-3a11-11e9-952b-97cc981efd76.html',
                             'summary': 'According to a recent Modern Healthcare CEO Power Panel survey, there is less of an appetite for mergers and acquisitions this year than in 2018. In 2019, 12.5% of CEOs said M&A best describes their growth strategy, down from 25.8% in 2018. Among the 29 data points studied, the researchers analyzed hospital readmission rates, process of care measurements that gauge how well a hospital provides care to its patients, and patient satisfaction scores. Using that information, they tested whether patient outcomes are influenced by greater hospital market concentration or vertical integration between hospitals and physicians. Before they launched their study, the researchers hypothesized that decreased fragmentation, meaning better coordination among a patient\'s primary care physician, specialists and admitting and attending hospital physicians, could improve patient care. "Therefore, we need further research on the ability of patient satisfaction to reflect clinical quality, and if it does not, we need to develop and provide to patients better measures in terms that patients can understand and use."',
                            }
                         )
